"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[9897],{73826:function(e,t,r){r.d(t,{f:function(){return f}});var a=r(40039),s=r(33368),i=r(71650),o=r(82390),n=r(69205),d=r(70906),u=r(91808),c=r(34541),l=r(47838),h=(r(97393),r(46798),r(47084),r(51358),r(98490),r(40271),r(60163),r(9849),r(13526),r(95260)),f=function(e){var t=(0,u.Z)(null,(function(e,t){var r=function(t){(0,n.Z)(a,t);var r=(0,d.Z)(a);function a(){var t;(0,i.Z)(this,a);for(var s=arguments.length,n=new Array(s),d=0;d<s;d++)n[d]=arguments[d];return t=r.call.apply(r,[this].concat(n)),e((0,o.Z)(t)),t}return(0,s.Z)(a)}(t);return{F:r,d:[{kind:"field",decorators:[(0,h.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,c.Z)((0,l.Z)(r.prototype),"connectedCallback",this).call(this),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,c.Z)((0,l.Z)(r.prototype),"disconnectedCallback",this).call(this),this.__unsubs){for(;this.__unsubs.length;){var e=this.__unsubs.pop();e instanceof Promise?e.then((function(e){return e()})):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,c.Z)((0,l.Z)(r.prototype),"updated",this).call(this,e),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps){var t,s=(0,a.Z)(e.keys());try{for(s.s();!(t=s.n()).done;){var i=t.value;if(this.hassSubscribeRequiredHostProps.includes(i))return void this.__checkSubscribed()}}catch(o){s.e(o)}finally{s.f()}}}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){var e,t=this;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((function(e){return void 0===t[e]}))||(this.__unsubs=this.hassSubscribe())}}]}}),e);return t}},9897:function(e,t,r){r.r(t),r.d(t,{HuiEnergyUsageGraphCard:function(){return H}});var a,s,i,o,n=r(99312),d=r(53709),u=r(68990),c=r(81043),l=r(40039),h=r(88962),f=r(33368),_=r(71650),y=r(82390),g=r(69205),v=r(70906),b=r(91808),p=(r(97393),r(46798),r(9849),r(13526),r(87438),r(22890),r(85717),r(11451),r(50289),r(94167),r(82073),r(10733),r(36513),r(40271),r(65974),r(32797),r(5239),r(51358),r(78399),r(56086),r(47884),r(81912),r(64584),r(41483),r(12367),r(9454),r(98490),r(76843),r(27088)),m=r(70390),k=r(53970),Z=r(24112),x=r(72277),S=r(59699),C=r(68144),w=r(95260),O=r(83448),j=r(14516),P=r(15838),E=r(89525),M=r(12198),z=r(49684),D=r(18457),R=(r(62336),r(22098),r(55424)),A=r(38014),B=r(73826),V=r(53658),H=(0,b.Z)([(0,w.Mo)("hui-energy-usage-graph-card")],(function(e,t){var r,b=function(t){(0,g.Z)(a,t);var r=(0,v.Z)(a);function a(){var t;(0,_.Z)(this,a);for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return t=r.call.apply(r,[this].concat(i)),e((0,y.Z)(t)),t}return(0,f.Z)(a)}(t);return{F:b,d:[{kind:"field",decorators:[(0,w.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,w.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,w.SB)()],key:"_chartData",value:function(){return{datasets:[]}}},{kind:"field",decorators:[(0,w.SB)()],key:"_start",value:function(){return(0,p.Z)()}},{kind:"field",decorators:[(0,w.SB)()],key:"_end",value:function(){return(0,m.Z)()}},{kind:"field",decorators:[(0,w.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,w.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:function(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e,t=this;return[(0,R.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((function(e){return t._getStatistics(e)}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,V.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,C.dy)(a||(a=(0,h.Z)([" <ha-card> ",' <div class="content ','"> <ha-chart-base .hass="','" .data="','" .options="','" chart-type="bar"></ha-chart-base> '," </div> </ha-card> "])),this._config.title?(0,C.dy)(s||(s=(0,h.Z)(['<h1 class="card-header">',"</h1>"])),this._config.title):"",(0,O.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.datasets.some((function(e){return e.data.length}))?"":(0,C.dy)(i||(i=(0,h.Z)(['<div class="no-data"> '," </div>"])),(0,k.Z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):C.Ld}},{kind:"field",key:"_createOptions",value:function(){var e=this;return(0,j.Z)((function(t,r,a,s,i,o){var n=(0,Z.Z)(r,t),d=void 0!==i&&void 0!==o;if(d){var u=(0,x.Z)(r,t),c=(0,x.Z)(o,i);c>u?r=(0,S.Z)(r,c-u):u>c&&(o=(0,S.Z)(o,u-c))}var h={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),suggestedMax:r.getTime(),adapters:{date:{locale:a,config:s}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:function(e){return e.tick&&e.tick.major?{weight:"bold"}:{}}},time:{tooltipFormat:n>35?"monthyear":n>7?"date":n>2?"weekday":n>0?"datetime":"hour",minUnit:n>35?"month":n>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:"kWh"},ticks:{beginAtZero:!0,callback:function(e){return(0,D.uf)(Math.abs(e),a)}}}},plugins:{tooltip:{position:"nearest",filter:function(e){return"0"!==e.formattedValue},itemSort:function(e,t){var r,a,s,i,o;return(null===(r=e.raw)||void 0===r?void 0:r.y)>0&&(null===(a=t.raw)||void 0===a?void 0:a.y)<0?-1:(null===(s=t.raw)||void 0===s?void 0:s.y)>0&&(null===(i=e.raw)||void 0===i?void 0:i.y)<0?1:(null===(o=e.raw)||void 0===o?void 0:o.y)>0?t.datasetIndex-e.datasetIndex:e.datasetIndex-t.datasetIndex},callbacks:{title:function(e){if(n>0)return e[0].label;var t=new Date(e[0].parsed.x);return"".concat(d?"".concat((0,M.ud)(t,a,s),": "):"").concat((0,z.mr)(t,a,s)," â€“ ").concat((0,z.mr)((0,S.Z)(t,1),a,s))},label:function(e){return"".concat(e.dataset.label,": ").concat((0,D.uf)(Math.abs(e.parsed.y),a)," kWh")},footer:function(t){var r,s=0,i=0,o=(0,l.Z)(t);try{for(o.s();!(r=o.n()).done;){var n=r.value,d=n.dataset.data[n.dataIndex].y;d>0?s+=d:i+=Math.abs(d)}}catch(u){o.e(u)}finally{o.f()}return[s?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,D.uf)(s,a)}):"",i?e.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned",{num:(0,D.uf)(i,a)}):""].filter(Boolean)}}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,D.Hd)(a)};return d&&(h.scales.xAxisCompare=Object.assign(Object.assign({},h.scales.x),{},{suggestedMin:i.getTime(),suggestedMax:o.getTime(),display:!1})),h}))}},{kind:"method",key:"_getStatistics",value:(r=(0,c.Z)((0,n.Z)().mark((function e(t){var r,a,s,i,o,c,h,f,_,y,g,v,b,p,k;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a={},s=(0,l.Z)(t.prefs.energy_sources),e.prev=3,s.s();case 5:if((i=s.n()).done){e.next=21;break}if("solar"!==(o=i.value).type){e.next=10;break}return a.solar?a.solar.push(o.stat_energy_from):a.solar=[o.stat_energy_from],e.abrupt("continue",19);case 10:if("battery"!==o.type){e.next=13;break}return a.to_battery?(a.to_battery.push(o.stat_energy_to),a.from_battery.push(o.stat_energy_from)):(a.to_battery=[o.stat_energy_to],a.from_battery=[o.stat_energy_from]),e.abrupt("continue",19);case 13:if("grid"===o.type){e.next=15;break}return e.abrupt("continue",19);case 15:c=(0,l.Z)(o.flow_from);try{for(c.s();!(h=c.n()).done;)f=h.value,a.from_grid?a.from_grid.push(f.stat_energy_from):a.from_grid=[f.stat_energy_from]}catch(n){c.e(n)}finally{c.f()}_=(0,l.Z)(o.flow_to);try{for(_.s();!(y=_.n()).done;)g=y.value,a.to_grid?a.to_grid.push(g.stat_energy_to):a.to_grid=[g.stat_energy_to]}catch(n){_.e(n)}finally{_.f()}case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),s.e(e.t0);case 26:return e.prev=26,s.f(),e.finish(26);case 29:v=getComputedStyle(this),b={to_grid:"--energy-grid-return-color",to_battery:"--energy-battery-in-color",from_grid:"--energy-grid-consumption-color",used_grid:"--energy-grid-consumption-color",used_solar:"--energy-solar-color",used_battery:"--energy-battery-out-color"},p={to_grid:{base:v.getPropertyValue(b.to_grid).trim()},to_battery:{base:v.getPropertyValue(b.to_battery).trim()},from_grid:{base:v.getPropertyValue(b.from_grid).trim()},used_grid:{base:v.getPropertyValue(b.used_grid).trim()},used_solar:{base:v.getPropertyValue(b.used_solar).trim()},used_battery:{base:v.getPropertyValue(b.used_battery).trim()}},Object.entries(b).forEach((function(e){var t=(0,u.Z)(e,2),r=t[0],s=t[1];"used_grid"!==r&&"used_solar"!==r&&"used_battery"!==r&&(p[r].overrides=[],a[r]&&Object.values(a[r]).forEach((function(e,t){var a=v.getPropertyValue(s+"-"+t).trim();a.length>0&&(p[r].overrides[e]=a)})))})),k={used_grid:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid"),used_solar:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar"),used_battery:this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery")},this._start=t.start,this._end=t.end||(0,m.Z)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,r.push.apply(r,(0,d.Z)(this._processDataSet(t.stats,t.statsMetadata,a,p,k,!1))),t.statsCompare&&(r.push({order:0,data:[]}),r.push({order:999,data:[],xAxisID:"xAxisCompare"}),r.push.apply(r,(0,d.Z)(this._processDataSet(t.statsCompare,t.statsMetadata,a,p,k,!0)))),this._chartData={datasets:r};case 41:case"end":return e.stop()}}),e,this,[[3,23,26,29]])}))),function(e){return r.apply(this,arguments)})},{kind:"method",key:"_processDataSet",value:function(e,t,r,a,s){var i,o=this,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=[],c={},l={};Object.entries(r).forEach((function(t){var r=(0,u.Z)(t,2),a=r[0],s=r[1],o=["solar","to_grid","from_grid","to_battery","from_battery"].includes(a),n=!["solar","from_battery"].includes(a),d={},h={};s.forEach((function(t){var r=e[t];if(r){var a={};r.forEach((function(e){if(null!==e.change&&void 0!==e.change){var t=e.change;o&&(d[e.start]=e.start in d?d[e.start]+t:t,i=e.end),n&&!(e.start in a)&&(a[e.start]=t,i=e.end)}})),h[t]=a}})),o&&(l[a]=d),n&&(c[a]=h)}));var h={},f={};if((l.to_grid||l.to_battery)&&l.solar){for(var _={},y=0,g=Object.keys(l.solar);y<g.length;y++){var v,b,p=g[y];if(_[p]=(l.solar[p]||0)-((null===(v=l.to_grid)||void 0===v?void 0:v[p])||0)-((null===(b=l.to_battery)||void 0===b?void 0:b[p])||0),_[p]<0){var m,k,Z;if(l.to_battery)if(h[p]=-1*_[p],h[p]>((null===(m=l.from_grid)||void 0===m?void 0:m[p])||0))f[p]=Math.min(0,h[p]-((null===(k=l.from_grid)||void 0===k?void 0:k[p])||0)),h[p]=null===(Z=l.from_grid)||void 0===Z?void 0:Z[p];_[p]=0}}c.used_solar={used_solar:_}}if(l.from_battery)if(l.to_grid){for(var x={},S=0,C=Object.keys(l.from_battery);S<C.length;S++){var w=C[S];x[w]=(l.from_battery[w]||0)-(f[w]||0)}c.used_battery={used_battery:x}}else c.used_battery={used_battery:l.from_battery};if(c.from_grid&&l.to_battery){for(var O={},j=function(){for(var e,t=z[M],r=0,a=0,s=Object.entries(c.from_grid);a<s.length;a++){var i=(0,u.Z)(s[a],2),o=i[0];if(i[1][t]&&(e=o,r++),r>1)break}if(1===r)c.from_grid[e][t]-=h[t]||0;else{var n=0;Object.values(c.from_grid).forEach((function(e){n+=e[t]||0,delete e[t]})),O[t]=n-(h[t]||0)}},M=0,z=Object.keys(h);M<z.length;M++)j();c.used_grid={used_grid:O}}var D=[];Object.values(c).forEach((function(e){Object.values(e).forEach((function(e){D=D.concat(Object.keys(e))}))}));var R=Array.from(new Set(D));return Object.entries(c).forEach((function(e){var r=(0,u.Z)(e,2),l=r[0],h=r[1];Object.entries(h).forEach((function(e,r){var h,f=(0,u.Z)(e,2),_=f[0],y=f[1],g=null===(h=a[l].overrides)||void 0===h?void 0:h[_];if(!g){var v=r>0?o.hass.themes.darkMode?(0,E.C)((0,P.Rw)((0,P.wK)(a[l].base)),r):(0,E.W)((0,P.Rw)((0,P.wK)(a[l].base)),r):void 0;g=v?(0,P.CO)((0,P.p3)(v)):a[l].base}for(var b=[],p=0,m=R;p<m.length;p++){var k=m[p],Z=y[k]||0;b.push({x:Number(k),y:Z&&["to_grid","to_battery"].includes(l)?-1*Z:Z})}1===b.length&&b.push({x:i,y:0}),d.push({label:l in s?s[l]:(0,A.Kd)(o.hass,_,t[_]),order:"used_solar"===l?1:"to_battery"===l?Object.keys(c).length:r+2,borderColor:n?g+"7F":g,backgroundColor:n?g+"32":g+"7F",stack:"stack",data:b,xAxisID:n?"xAxisCompare":void 0})}))})),d}},{kind:"get",static:!0,key:"styles",value:function(){return(0,C.iv)(o||(o=(0,h.Z)(["ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;box-sizing:border-box}"])))}}]}}),(0,B.f)(C.oi))}}]);
//# sourceMappingURL=9897.dS96GoDwbYs.js.map