{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Box,FormControl,InputLabel,MenuItem,Select,TextField}from'@mui/material';import React,{useContext,useEffect,useState}from'react';import{ApiContext}from'../../components/apiContext';import ModelCard from'./modelCard';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LaunchLLM=function LaunchLLM(){var endPoint=useContext(ApiContext).endPoint;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),registrationData=_useState2[0],setRegistrationData=_useState2[1];var _useContext=useContext(ApiContext),isCallingApi=_useContext.isCallingApi,setIsCallingApi=_useContext.setIsCallingApi;var _useContext2=useContext(ApiContext),isUpdatingModel=_useContext2.isUpdatingModel;var _useContext3=useContext(ApiContext),setErrorMsg=_useContext3.setErrorMsg;// States used for filtering\nvar _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),searchTerm=_useState4[0],setSearchTerm=_useState4[1];var _useState5=useState('all'),_useState6=_slicedToArray(_useState5,2),modelAbility=_useState6[0],setModelAbility=_useState6[1];var _useState7=useState(-1),_useState8=_slicedToArray(_useState7,2),gpuAvailable=_useState8[0],setGPUAvailable=_useState8[1];var handleChange=function handleChange(event){setSearchTerm(event.target.value);};var handleAbilityChange=function handleAbilityChange(event){setModelAbility(event.target.value);};var filter=function filter(registration){if(!registration||typeof searchTerm!=='string')return false;var modelName=registration.model_name?registration.model_name.toLowerCase():'';var modelDescription=registration.model_description?registration.model_description.toLowerCase():'';if(!modelName.includes(searchTerm.toLowerCase())&&!modelDescription.includes(searchTerm.toLowerCase())){return false;}if(modelAbility&&modelAbility!=='all'){if(registration.model_ability.indexOf(modelAbility)<0){return false;}}return true;};var update=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,registrations,builtinRegistrations;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(isCallingApi||isUpdatingModel)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;setIsCallingApi(true);_context.next=6;return fetch(\"\".concat(endPoint,\"/v1/model_registrations/LLM?detailed=true\"),{method:'GET'});case 6:response=_context.sent;_context.next=9;return response.json();case 9:registrations=_context.sent;builtinRegistrations=registrations.filter(function(v){return v.is_builtin;});setRegistrationData(builtinRegistrations);_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](2);console.error('Error:',_context.t0);case 17:_context.prev=17;setIsCallingApi(false);return _context.finish(17);case 20:case\"end\":return _context.stop();}},_callee,null,[[2,14,17,20]]);}));return function update(){return _ref.apply(this,arguments);};}();useEffect(function(){update();},[]);useEffect(function(){if(gpuAvailable===-1){fetch(endPoint+'/v1/cluster/devices',{method:'GET',headers:{'Content-Type':'application/json'}}).then(function(res){if(!res.ok){// Usually, if some errors happen here, check if the cluster is available\nres.json().then(function(errorData){setErrorMsg(\"Server error: \".concat(res.status,\" - \").concat(errorData.detail||'Unknown error'));});}else{res.json().then(function(data){setGPUAvailable(parseInt(data,10));});}});}},[]);var style={display:'grid',gridTemplateColumns:'repeat(auto-fill, minmax(300px, 1fr))',paddingLeft:'2rem',gridGap:'2rem 0rem'};return/*#__PURE__*/_jsxs(Box,{m:\"20px\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'150px 1fr',columnGap:'20px',margin:'30px 2rem'},children:[/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"normal\",children:[/*#__PURE__*/_jsx(InputLabel,{id:\"ability-select-label\",children:\"Model Ability\"}),/*#__PURE__*/_jsxs(Select,{id:\"ability\",labelId:\"ability-select-label\",label:\"Model Ability\",onChange:handleAbilityChange,value:modelAbility,size:\"small\",sx:{width:'150px'},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"all\",children:\"all\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"generate\",children:\"generate\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"chat\",children:\"chat\"})]})]}),/*#__PURE__*/_jsx(FormControl,{variant:\"outlined\",margin:\"normal\",children:/*#__PURE__*/_jsx(TextField,{id:\"search\",type:\"search\",label:\"Search for model name and description\",value:searchTerm,onChange:handleChange,size:\"small\"})})]}),/*#__PURE__*/_jsx(\"div\",{style:style,children:registrationData.filter(function(registration){return filter(registration);}).map(function(filteredRegistration){return/*#__PURE__*/_jsx(ModelCard,{url:endPoint,modelData:filteredRegistration,gpuAvailable:gpuAvailable});})})]});};export default LaunchLLM;","map":{"version":3,"names":["Box","FormControl","InputLabel","MenuItem","Select","TextField","React","useContext","useEffect","useState","ApiContext","ModelCard","jsx","_jsx","jsxs","_jsxs","LaunchLLM","endPoint","_useState","_useState2","_slicedToArray","registrationData","setRegistrationData","_useContext","isCallingApi","setIsCallingApi","_useContext2","isUpdatingModel","_useContext3","setErrorMsg","_useState3","_useState4","searchTerm","setSearchTerm","_useState5","_useState6","modelAbility","setModelAbility","_useState7","_useState8","gpuAvailable","setGPUAvailable","handleChange","event","target","value","handleAbilityChange","filter","registration","modelName","model_name","toLowerCase","modelDescription","model_description","includes","model_ability","indexOf","update","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","registrations","builtinRegistrations","wrap","_callee$","_context","prev","next","abrupt","fetch","concat","method","sent","json","v","is_builtin","t0","console","error","finish","stop","apply","arguments","headers","then","res","ok","errorData","status","detail","data","parseInt","style","display","gridTemplateColumns","paddingLeft","gridGap","m","children","columnGap","margin","variant","id","labelId","label","onChange","size","sx","width","type","map","filteredRegistration","url","modelData"],"sources":["/home/runner/work/inference/inference/xinference/web/ui/src/scenes/launch_model/launchLLM.js"],"sourcesContent":["import {\n  Box,\n  FormControl,\n  InputLabel,\n  MenuItem,\n  Select,\n  TextField,\n} from '@mui/material'\nimport React, { useContext, useEffect, useState } from 'react'\n\nimport { ApiContext } from '../../components/apiContext'\nimport ModelCard from './modelCard'\n\nconst LaunchLLM = () => {\n  let endPoint = useContext(ApiContext).endPoint\n  const [registrationData, setRegistrationData] = useState([])\n  const { isCallingApi, setIsCallingApi } = useContext(ApiContext)\n  const { isUpdatingModel } = useContext(ApiContext)\n  const { setErrorMsg } = useContext(ApiContext)\n\n  // States used for filtering\n  const [searchTerm, setSearchTerm] = useState('')\n\n  const [modelAbility, setModelAbility] = useState('all')\n  const [gpuAvailable, setGPUAvailable] = useState(-1)\n\n  const handleChange = (event) => {\n    setSearchTerm(event.target.value)\n  }\n\n  const handleAbilityChange = (event) => {\n    setModelAbility(event.target.value)\n  }\n\n  const filter = (registration) => {\n    if (!registration || typeof searchTerm !== 'string') return false\n    const modelName = registration.model_name\n      ? registration.model_name.toLowerCase()\n      : ''\n    const modelDescription = registration.model_description\n      ? registration.model_description.toLowerCase()\n      : ''\n\n    if (\n      !modelName.includes(searchTerm.toLowerCase()) &&\n      !modelDescription.includes(searchTerm.toLowerCase())\n    ) {\n      return false\n    }\n    if (modelAbility && modelAbility !== 'all') {\n      if (registration.model_ability.indexOf(modelAbility) < 0) {\n        return false\n      }\n    }\n    return true\n  }\n\n  const update = async () => {\n    if (isCallingApi || isUpdatingModel) return\n\n    try {\n      setIsCallingApi(true)\n\n      const response = await fetch(\n        `${endPoint}/v1/model_registrations/LLM?detailed=true`,\n        {\n          method: 'GET',\n        }\n      )\n\n      const registrations = await response.json()\n      const builtinRegistrations = registrations.filter((v) => v.is_builtin)\n\n      setRegistrationData(builtinRegistrations)\n    } catch (error) {\n      console.error('Error:', error)\n    } finally {\n      setIsCallingApi(false)\n    }\n  }\n\n  useEffect(() => {\n    update()\n  }, [])\n\n  useEffect(() => {\n    if (gpuAvailable === -1) {\n      fetch(endPoint + '/v1/cluster/devices', {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      }).then((res) => {\n        if (!res.ok) {\n          // Usually, if some errors happen here, check if the cluster is available\n          res.json().then((errorData) => {\n            setErrorMsg(\n              `Server error: ${res.status} - ${\n                errorData.detail || 'Unknown error'\n              }`\n            )\n          })\n        } else {\n          res.json().then((data) => {\n            setGPUAvailable(parseInt(data, 10))\n          })\n        }\n      })\n    }\n  }, [])\n\n  const style = {\n    display: 'grid',\n    gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',\n    paddingLeft: '2rem',\n    gridGap: '2rem 0rem',\n  }\n\n  return (\n    <Box m=\"20px\">\n      <div\n        style={{\n          display: 'grid',\n          gridTemplateColumns: '150px 1fr',\n          columnGap: '20px',\n          margin: '30px 2rem',\n        }}\n      >\n        <FormControl variant=\"outlined\" margin=\"normal\">\n          <InputLabel id=\"ability-select-label\">Model Ability</InputLabel>\n          <Select\n            id=\"ability\"\n            labelId=\"ability-select-label\"\n            label=\"Model Ability\"\n            onChange={handleAbilityChange}\n            value={modelAbility}\n            size=\"small\"\n            sx={{ width: '150px' }}\n          >\n            <MenuItem value=\"all\">all</MenuItem>\n            <MenuItem value=\"generate\">generate</MenuItem>\n            <MenuItem value=\"chat\">chat</MenuItem>\n          </Select>\n        </FormControl>\n        <FormControl variant=\"outlined\" margin=\"normal\">\n          <TextField\n            id=\"search\"\n            type=\"search\"\n            label=\"Search for model name and description\"\n            value={searchTerm}\n            onChange={handleChange}\n            size=\"small\"\n          />\n        </FormControl>\n      </div>\n      <div style={style}>\n        {registrationData\n          .filter((registration) => filter(registration))\n          .map((filteredRegistration) => (\n            <ModelCard\n              url={endPoint}\n              modelData={filteredRegistration}\n              gpuAvailable={gpuAvailable}\n            />\n          ))}\n      </div>\n    </Box>\n  )\n}\n\nexport default LaunchLLM\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}