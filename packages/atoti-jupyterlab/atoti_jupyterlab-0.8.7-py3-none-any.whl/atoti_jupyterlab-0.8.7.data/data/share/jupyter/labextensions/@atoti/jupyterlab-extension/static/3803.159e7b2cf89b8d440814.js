"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[3803],{43803:(e,t,r)=>{r.r(t),r.d(t,{canOpenDrillthroughOnSelection:()=>y,getDrillthroughWidgetFilters:()=>S,pluginMenuItemOpenDrillthrough:()=>x});var n=r(93388),i=r(77026),l=r(66029),a=r(93481),o=r(84138),u=r(34420),s=r(51588),m=r(51786),d=r(85672),h=r(95326),c=r(65942),g=r(71265),p=r(2445),f=r(49678),b=r(99856);function y(e){return void 0!==e&&!(e.axes&&e.axes.length>0)&&void 0!==e.cells&&1===e.cells.length&&void 0!==e.cells[0].value}var C=r(37801),v=r(10665),D=r(33419);function N(e,t){const{dimensionName:r,hierarchyName:n}=e;return t.some((e=>(0,D.I)(e,{dimensionName:r,hierarchyName:n})))}function S({sourceWidgetFilters:e,tuple:t,cube:r}){return[...(e||[]).filter((e=>!N(e,t))),...t.map((({dimensionName:e,hierarchyName:t,namePath:r})=>({type:"members",dimensionName:e,hierarchyName:t,members:[r]})))]}const x={key:"open-drillthrough",useMenuItem:e=>{const{selection:t,widgetState:r}=e,{cube:D,serverKey:x}=(0,b.useCube)(r),{formatMessage:M}=(0,a.useIntl)(),k=(0,d.T)(),F=(0,l.useMemo)((()=>{if(y(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,u.isTotal)((0,g._)(e,D),e)))}),[D,t]),W=(0,l.useMemo)((()=>{if(F){const e=F.filter((e=>"Measures"!==e.dimensionName));return M({id:"aui.plugins.menu-item.open-drillthrough.openDrillthrough"},{member:e.length>0?(0,u.getTupleCaption)(e,{captionForTotals:M({id:"aui.total"}),cube:D,separator:", ",hasOnlyCaptionForLeafLevels:!0}):void 0})}}),[M,F,D]),[O]=(0,s.y)("drillthrough.defaultSelectedColumns"),[_]=(0,m.o)(x,D.name),I=(0,l.useMemo)((()=>{const e=(0,f.K)(_??[]);return(0,i.flatten)(["numeric","regular","date"].map((t=>e[t]??[])))}),[_]),K=(0,l.useCallback)((async()=>{if(k&&W&&F&&(0,o.F)(e)){const t=(0,h.A)(e.dashboardState.pagesOrder),n=e.dashboardState.pagesOrder.indexOf(k),l=e.dashboardState.pages[k];if(void 0===r.query.mdx)return;const a=function({name:e,sourceWidget:t,sourceWidgetPage:r,tuple:n,drillthroughColumns:l,defaultSelectedColumns:a,cube:o}){const u=S({sourceWidgetFilters:t.filters,tuple:n,cube:o}),s=(0,i.map)(l,"name"),m=a[o.name]?(0,i.intersection)(s,a[o.name]):s,d={mdx:(0,C.r)((0,b.getDefaultMdxDrillthrough)(o.name),{drillthroughColumnUniqueNames:m})},h=(r.filters||[]).filter((e=>!N(e,n)));return{name:e,content:{0:{...v.o.initialState,query:d,serverKey:t.serverKey,initialCubeName:o.name,filters:u}},layout:{direction:"column",children:[{leafKey:"0",size:1}]},filters:h}}({name:W,sourceWidget:r,sourceWidgetPage:l,tuple:F,drillthroughColumns:I,defaultSelectedColumns:O,cube:D}),o=(0,c.W)(e.dashboardState,{page:a,key:t,index:n+1});e.onDashboardChange(o),e.onActivePageChange(t)}}),[k,D,W,e,F,r,O,I]);if((0,o.F)(e)&&F&&r.query.mdx)return{icon:(0,n.tZ)(p.IconDrillthrough,{}),label:W,onClick:K}},translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"},"fr-FR":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {sur {member}}\n          }"}}}}}]);