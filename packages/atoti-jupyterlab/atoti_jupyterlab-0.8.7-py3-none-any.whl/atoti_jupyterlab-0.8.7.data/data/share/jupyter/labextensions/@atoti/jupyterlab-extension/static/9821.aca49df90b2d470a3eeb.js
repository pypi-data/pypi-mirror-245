"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[9821],{86942:(e,t,o)=>{o.d(t,{XN:()=>Z});var n=o(93388),r=o(77026),a=o(66029),l=o(45030),i=o(69540),s=o(12274),u=o(6611),c=o(32277),d=o(15169),p=o(99856),h=o(9617),m=o(93481);const g=({subplotsMetaData:e,horizontalLimit:t,verticalLimit:o,style:r})=>{const{formatMessage:a}=(0,m.useIntl)(),l=e.horizontal.keys.length,i=e.vertical.keys.length,s=l>t,u=s&&i>o?a({id:"aui.dataVisualization.subplots.tooManyHorizontalAndVerticalSubplots"},{horizontalSubplotLimit:t,verticalSubplotLimit:o,horizontalSubplotTotal:l,verticalSubplotTotal:i,horizontalLevelName:e.horizontal.levelName,verticalLevelName:e.vertical.levelName}):a({id:"aui.dataVisualization.subplots.tooManySubplots"},{limit:s?t:o,total:s?l:i,areTooManyHorizontalSubplots:s,subplotLevelName:s?e.horizontal.levelName:e.vertical.levelName});return(0,n.tZ)(h.Alert,{message:`${u} ${a({id:"aui.dataVisualization.subplots.editQuery"})}`,showIcon:!0,banner:!0,style:{...r,zIndex:1},type:"warning"})};var f=o(34420),y=o(3920),b=o(22589);const v={left:"unset !important",right:"-5px !important"},x={left:"-5px !important",right:"unset !important"},C={boxShadow:"3px -3px 7px rgba(0, 0, 0, 0.07) !important",transform:"translateX(-6px) rotate(45deg) !important"},I={boxShadow:"-3px 3px 7px rgba(0, 0, 0, 0.07) !important",transform:"translateX(6px) rotate(45deg) !important"};var S=o(92644);class w extends Error{}const z=({selectedPointsByTrace:e,traces:t,data:o})=>{const n=(0,f.getHierarchyIndicesInCellSet)(o),r=[];return e.forEach(((e,a)=>{t[a]&&r.push(...(({selectedPoints:e,cellsIndices:t,data:o,hierarchyIndicesInCellSet:n})=>{const r=[];return e.forEach((e=>{(t[e]||[]).forEach((a=>{if(!a)throw new w(`The point at index ${e} is marked as selected but it exceeds the number of points on the chart: ${t.length}`);{const{columnIndex:e,rowIndex:t,cellIndex:l}=a,i=(0,f.getTuple)({columnIndex:e,rowIndex:t,data:o,hierarchyIndicesInCellSet:n});if(i){const e=o.cells[l];r.push({tuple:i,value:e.value})}}}))})),r})({selectedPoints:e,cellsIndices:t[a].cellsIndices,data:o,hierarchyIndicesInCellSet:n}))})),{cells:r}},M=36,L=(0,a.lazy)((()=>Promise.all([o.e(9251),o.e(963)]).then(o.bind(o,10963)))),k=e=>(0,n.tZ)(a.Suspense,{fallback:(0,n.tZ)("div",{children:"Loading..."}),children:(0,n.tZ)(L,{...e})});function T(e){return(0,r.range)(e).map((()=>[]))}function N(e){const{pointIndex:t,pointNumber:o}=e;return void 0!==t?t:o}function Z(e){const t=(0,a.useMemo)((()=>e.onSelectionChange||(()=>{})),[e.onSelectionChange]),o=(0,a.useRef)(null),[h,L]=(0,a.useState)(null),Z=(0,p.useIsContextMenuOpen)(),D=e.widgetState?.plotly?.layout,B=e.widgetState?.plotly?.config,E=e.widgetState?.plotly?.data,P=(0,a.useMemo)((()=>function(e,t={}){const{additionalTraces:o,commonTraceOverride:n,overridesByTraceIndex:a,overridesByTraceKey:l}=t;return[...e.map(((e,t)=>(0,r.defaultsDeep)({},l?.[e._key],a?.[t],n,e))),...o||[]]}(e.traces,E)),[e.traces,E]),R=function(e){const{backgroundColor:t,textColor:o,black:n}=e;return(0,a.useMemo)((()=>function({backgroundColor:e,textColor:t,black:o}){return{bgColor:e,fontColor:t,hoverBgColor:o,hoverFontColor:e,zeroLineColor:(0,i.U)(t,.5),lineColor:(0,i.U)(t,.25),gridColor:(0,i.U)(t,.25)}}({backgroundColor:t,textColor:o,black:n})),[t,o,n])}((0,s.Fg)()),_=(0,a.useMemo)((()=>({displaylogo:!1,modeBarButtonsToRemove:["resetScale2d","toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian","toggleHover"],...B})),[B]),[V,$]=(0,a.useState)([]),[X,q]=(0,a.useState)({}),[F,H]=(0,a.useState)([]),O=(0,a.useRef)(null);(0,a.useEffect)((()=>{try{const o=z({selectedPointsByTrace:V,traces:P,data:e.data});t(o)}catch(e){e instanceof w&&$([])}}),[V,P,e.data,t]);const U=e.metaData.subplots.horizontal.limit,K=e.metaData.subplots.vertical.limit,j=e.metaData.subplots.horizontal.keys.length>U||e.metaData.subplots.vertical.keys.length>K,A=(0,a.useMemo)((()=>j?{height:e.size.height-M,width:e.size.width}:e.size),[j,e.size]),Q=(0,a.useMemo)((()=>function({chartThemeValues:e,layoutOverrides:t,layout:o,hiddenLabels:n,size:a}){return(0,r.defaultsDeep)((0,r.cloneDeep)(t),o,{colorway:S.i,plot_bgcolor:e.bgColor,paper_bgcolor:e.bgColor,font:{color:e.fontColor},hoverlabel:{bgcolor:e.hoverBgColor,bordercolor:e.hoverBgColor,font:{color:e.hoverFontColor}},hovermode:"closest",margin:{t:30,r:0,b:40},xaxis:{automargin:!0,zerolinecolor:e.zeroLineColor,linecolor:e.lineColor,gridcolor:e.gridColor,range:[]},yaxis:{automargin:!0,zerolinecolor:e.zeroLineColor,linecolor:e.lineColor,gridcolor:e.gridColor,range:[]},hiddenlabels:n,...a})}({chartThemeValues:R,layoutOverrides:D,layout:e.layout,hiddenLabels:F,size:A})),[R,D,e.layout,F,A]),[W,Y,G]=(0,d.useMousePosition)(),J=(0,a.useMemo)((()=>P.map(((e,t)=>({...(0,r.omit)(e,"cellsIndices"),selectedpoints:V[t],...X[e._key]})))),[P,V,X]),ee=function({cube:e,data:t,hierarchyIndicesInCellSet:o,hoveredPoint:n,traces:r,style:l}){const{formatMessage:i}=(0,m.useIntl)(),s=i({id:"aui.total"});return(0,a.useMemo)((()=>{if(null===n)return[];const a=r[n.traceIndex].cellsIndices[n.pointIndex];if(!a)return[];const i=[];return a.forEach((e=>{const{columnIndex:n,rowIndex:r,cellIndex:a}=e,s=(0,f.getTuple)({columnIndex:n,data:t,hierarchyIndicesInCellSet:o,rowIndex:r});if(s){const e=t.cells[a],o=s.find((({dimensionName:e,hierarchyName:t})=>"Measures"===e&&"Measures"===t)),n=o?l?.measures?.[o.namePath[0]]:void 0;i.push({tuple:s,formattedValue:(0,y.m)({valueFormattedByActivePivot:e.formattedValue,measureStyle:n,value:Number(e.value)})})}})),(0,b.X)({cube:e,tuplesAndFormattedValues:i,captionForTotals:s})}),[e,t,r,o,n,l,s])}({cube:e.cube,data:e.data,hierarchyIndicesInCellSet:e.metaData.hierarchyIndicesInCellSet,hoveredPoint:h,traces:e.traces,style:e.widgetState.style}),[te,oe,ne,re]=function({hoveredPoint:e,container:t,traces:o,tooltipContent:n}){const[r,l,i]=(0,a.useMemo)((()=>{if(null===e||null===t)return[null,null,null];const o=t.getBoundingClientRect();return[e.offsetY,e.offsetX,o.width-e.offsetX+10]}),[e,t]);return(0,a.useMemo)((()=>{if(null===r||null===l||null===i||null===t)return["left",{opacity:0},v,C];const e=22*n.length+12;return l>i?["left",{left:"unset !important",right:`${i+10}px !important`,paddingLeft:"unset",paddingRight:8,top:r-e/2+"px !important"},v,C]:["right",{left:`${l+10}px !important`,right:"unset !important",paddingLeft:8,paddingRight:"unset",top:r-e/2+"px !important"},x,I]}),[r,l,i,t,n])}({hoveredPoint:h,container:O.current,traces:J,tooltipContent:ee}),ae=j?(0,n.tZ)(g,{style:{height:M},subplotsMetaData:e.metaData.subplots,horizontalLimit:U,verticalLimit:K}):null;return(0,n.tZ)(a.Fragment,{children:(0,n.BX)("div",{className:"atoti-ui-plot","data-number-of-cells":e.data.cells.length,css:{height:"100%",position:"relative",width:"100%",":focus":{outline:"none"},".ant-tooltip":{maxWidth:"unset",...oe},".ant-tooltip-arrow":ne,".ant-tooltip-arrow::before":re},tabIndex:0,onMouseDown:()=>{O.current&&O.current.focus()},onKeyUp:e=>{"Escape"===e.key&&$([])},ref:O,children:[ae,(0,n.tZ)(d.Tooltip,{open:!Z&&ee.length>0,title:(0,n.tZ)(l.j,{content:ee}),placement:te,getPopupContainer:()=>O.current||document.body,overlayStyle:{maxWidth:350},children:(0,n.tZ)("div",{css:{position:"absolute",top:j?M:0,bottom:0,left:0,right:0,".js-plotly-plot":{height:"100%"},".plot-container-plotly":{height:"100%"},"@media print":{".modebar-container":{display:"none"}}},onContextMenu:e=>{e.preventDefault()},children:(0,n.tZ)(k,{config:_,data:J,layout:Q,onInitialized:function(t,o){e.onInitialized&&e.onInitialized(t,o),e.onLoaded&&(0,c.f)(e.onLoaded)},onClick:function(e){if(e&&e.event){const{event:t}=e,o=e.points[0];switch(t.button){case 0:!function(e,t){const{curveNumber:o}=t,n=N(t),a=e[u.q?"metaKey":"ctrlKey"];let l=a&&V.length>0?(0,r.cloneDeep)(V):T(P.length);const i=l[o].indexOf(n);a?-1===i?l[o].push(n):l[o].splice(i,1):V.length>0&&V.every(((e,t)=>t===o?1===e.length&&e[0]===n:0===e.length))?l=[]:l[o]=[n],$(l)}(t,o);break;case 2:!function(e,t){const{curveNumber:o}=t,n=N(t);if(!(V[o]||[]).includes(n)){const e=T(P.length);e[o]=[n],$(e)}e.wasHandled=!0}(t,o)}}},onSelected:function(e){if(e){const t=e.points.reduce(((e,{curveNumber:t,pointIndex:o})=>(e[t].push(o),e)),T(P.length));$(t)}},onHover:e=>{Y(),o.current=setTimeout((()=>{if(G(),e&&O.current){const t=O.current.getBoundingClientRect(),o=e.points[0],{curveNumber:n}=o,r=N(o);L({traceIndex:n,pointIndex:r,offsetX:W.current?.x-t.left+10,offsetY:W.current?.y-t.top})}}),300)},onUnhover:function(e){G(),L(null),o.current&&(clearTimeout(o.current),o.current=null)},onUpdate:function(e){e.data.some((e=>e.visible!==X[e._key]?.visible))&&q(e.data.reduce(((e,t)=>({...e,[t._key]:{visible:t.visible}})),{})),e.layout.hiddenlabels&&!(0,r.isEqual)(e.layout.hiddenlabels,F)&&H(e.layout.hiddenlabels)}})})})]})})}},26521:(e,t,o)=>{o.d(t,{S:()=>a});var n=o(12365),r=o(60379);const a=e=>{if(0===e.horizontal.captions.length&&0===e.vertical.captions.length)return{};const t=(0,r.N)(e.vertical),o=(0,r.N)(e.horizontal),a=[];for(let e=0;e<t;e++){const t=[];for(let r=0;r<o;r++){const o=0===r?"x":`x${r+1}`,a=(0,n.B)(e);t.push(`${o}${a}`)}a.push(t)}return{grid:{rows:t,columns:o,subplots:a,pattern:"coupled"}}}},12365:(e,t,o)=>{function n(e){return 0===e?"y":"y"+(2*e+1)}o.d(t,{B:()=>n})},60379:(e,t,o)=>{o.d(t,{N:()=>n});const n=({captions:e,limit:t})=>Math.max(1,Math.min(e.length,t))},1462:(e,t,o)=>{o.d(t,{H:()=>p});var n=o(93388),r=o(81292),a=o(66029),l=o(34420),i=o(23893),s=o(15169),u=o(99856),c=o(48253),d=o(85958);function p(e){return t=>{const{cube:o}=(0,u.useCube)(t.widgetState),{widgetState:p,queryResult:h,onLoaded:m}=t,g=t.queryResult.data,f=(0,a.useMemo)((()=>Boolean(g&&0===g.cells.length)),[g]),y=(0,a.useMemo)((()=>(0,u.isMappingEmpty)(p?.mapping)),[p?.mapping]),b=(0,a.useRef)(null),v=(0,s.useDebouncedComponentSize)(b),[x]=(0,i.useWidgetPlugins)([p.widgetKey]),{attributes:C}=x,I=(0,a.useMemo)((()=>{const e=C?(0,u.getSafeMapping)(p.mapping,C):p.mapping;return{...p,mapping:e}}),[p,C]),S=(0,d.S)(I,h,o);if(h.error){if((0,l.isQueryErrorOfType)(h.error,"QueryTimeoutException"))throw new l.QueryTimeoutError(h.error);throw new l.MdxError(h.error)}return function({isEmpty:e,onLoaded:t}){(0,a.useEffect)((()=>{e&&void 0!==t&&t()}),[])}({isEmpty:y||f,onLoaded:m}),(0,n.tZ)("div",{ref:b,css:r.css`
          height: 100%;
        `,children:o&&g&&S&&!y&&!f?(0,n.tZ)(e,{...t,widgetState:I,cube:o,data:g,metaData:S,size:v}):(0,n.tZ)(c.M,{reason:f?"noData":void 0})})}}},9909:(e,t,o)=>{o.d(t,{h:()=>a});var n=o(93388),r=o(99856);function a(e){return t=>(0,n.tZ)(r.WidgetLoadingOverlay,{isLoading:t.queryResult.isLoading,style:{...t.style,height:"100%"},children:(0,n.tZ)(e,{...t})})}},9930:(e,t,o)=>{o.d(t,{i:()=>l});var n=o(93388),r=o(66029),a=o(16640);function l(e){return t=>{const o=(0,r.useRef)((0,n.tZ)("div",{})),l=(0,r.useRef)(!1),i=t.widgetState,{mdx:s,context:u}=i.query,c=(0,a.Z)(s),d=(0,a.Z)(u),p=t.queryResult.isLoading,h=(0,a.Z)(p);return(c&&s!==c||d&&u!==d)&&(l.current=!0),h&&!p&&(l.current=!1),l.current||(o.current=(0,n.tZ)(e,{...t})),o.current}}}}]);