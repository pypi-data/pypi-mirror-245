import{S as ee,i as te,s as le,D as U,Z as Q,_ as Z,m as y,h as _,n as w,$ as _e,b as P,a0 as k,K as Ce,a1 as z,M as J,Q as ae,q as D,r as R,u as j,k as N,y as oe,l as C,z as re,F as T,A as ce,a7 as de,W as st,g as H,d as I,B as ue,a as Y,c as q,v as x,f as $,a3 as Ke,a4 as Pe,N as at,G as fe,L as Qe,X as Ze,Y as ot,p as O,ah as rt,ao as ct,a2 as dt,O as we,ai as ut,e as Ve,a8 as Be}from"./index.6d58eddb.js";import{ay as Le,L as ft,h as Je,N as ht,_ as Ee,X as xe,a8 as $e,aj as mt,ai as K,a2 as Se,d as gt,b3 as _t,al as pt,b7 as bt,bx as vt,av as kt,by as yt,bp as wt}from"./Commands.e431ac62.js";import{f as Te,g as Et}from"./notificationsStore.a58b8b24.js";import{c as Ne,L as Ie,a as Me}from"./colors.f6cbcb11.js";function ze(n){let e,t;return{c(){e=Q("title"),t=D(n[1])},l(l){e=Z(l,"title",{});var a=y(e);t=R(a,n[1]),a.forEach(_)},m(l,a){P(l,e,a),k(e,t)},p(l,a){a&2&&j(t,l[1])},d(l){l&&_(e)}}}function St(n){let e,t,l=n[1]&&ze(n),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],c={};for(let i=0;i<a.length;i+=1)c=U(c,a[i]);return{c(){e=Q("svg"),l&&l.c(),t=Q("path"),this.h()},l(i){e=Z(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var o=y(e);l&&l.l(o),t=Z(o,"path",{d:!0}),y(t).forEach(_),o.forEach(_),this.h()},h(){w(t,"d","M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"),_e(e,c)},m(i,o){P(i,e,o),l&&l.m(e,null),k(e,t)},p(i,[o]){i[1]?l?l.p(i,o):(l=ze(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),_e(e,c=Ce(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},o&1&&{width:i[0]},o&1&&{height:i[0]},o&4&&i[2],o&8&&i[3]]))},i:z,o:z,d(i){i&&_(e),l&&l.d()}}}function Nt(n,e,t){let l,a;const c=["size","title"];let i=J(e,c),{size:o=16}=e,{title:s=void 0}=e;return n.$$set=r=>{t(5,e=U(U({},e),ae(r))),t(3,i=J(e,c)),"size"in r&&t(0,o=r.size),"title"in r&&t(1,s=r.title)},n.$$.update=()=>{t(4,l=e["aria-label"]||e["aria-labelledby"]||s),t(2,a={"aria-hidden":l?void 0:!0,role:l?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=ae(e),[o,s,a,i,l]}class Ct extends ee{constructor(e){super(),te(this,e,Nt,St,le,{size:0,title:1})}}function De(n){let e,t;return{c(){e=Q("title"),t=D(n[1])},l(l){e=Z(l,"title",{});var a=y(e);t=R(a,n[1]),a.forEach(_)},m(l,a){P(l,e,a),k(e,t)},p(l,a){a&2&&j(t,l[1])},d(l){l&&_(e)}}}function Ht(n){let e,t,l=n[1]&&De(n),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:n[0]},{height:n[0]},n[2],n[3]],c={};for(let i=0;i<a.length;i+=1)c=U(c,a[i]);return{c(){e=Q("svg"),l&&l.c(),t=Q("path"),this.h()},l(i){e=Z(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var o=y(e);l&&l.l(o),t=Z(o,"path",{d:!0}),y(t).forEach(_),o.forEach(_),this.h()},h(){w(t,"d","M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"),_e(e,c)},m(i,o){P(i,e,o),l&&l.m(e,null),k(e,t)},p(i,[o]){i[1]?l?l.p(i,o):(l=De(i),l.c(),l.m(e,t)):l&&(l.d(1),l=null),_e(e,c=Ce(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},o&1&&{width:i[0]},o&1&&{height:i[0]},o&4&&i[2],o&8&&i[3]]))},i:z,o:z,d(i){i&&_(e),l&&l.d()}}}function Pt(n,e,t){let l,a;const c=["size","title"];let i=J(e,c),{size:o=16}=e,{title:s=void 0}=e;return n.$$set=r=>{t(5,e=U(U({},e),ae(r))),t(3,i=J(e,c)),"size"in r&&t(0,o=r.size),"title"in r&&t(1,s=r.title)},n.$$.update=()=>{t(4,l=e["aria-label"]||e["aria-labelledby"]||s),t(2,a={"aria-hidden":l?void 0:!0,role:l?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=ae(e),[o,s,a,i,l]}class Vt extends ee{constructor(e){super(),te(this,e,Pt,Ht,le,{size:0,title:1})}}function Bt(n,e){const t=l=>n&&!n.contains(l.target)&&!l.defaultPrevented&&e();return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Lt(n){let e=(n[1]?"":n[0])+"",t;return{c(){t=D(e)},l(l){t=R(l,e)},m(l,a){P(l,t,a)},p(l,a){a&3&&e!==(e=(l[1]?"":l[0])+"")&&j(t,e)},d(l){l&&_(t)}}}function Tt(n){let e,t,l,a,c;const i=[n[2],{type:"purple"},{icon:Le}];let o={$$slots:{default:[Lt]},$$scope:{ctx:n}};for(let s=0;s<i.length;s+=1)o=U(o,i[s]);return t=new ft({props:o}),{c(){e=N("div"),oe(t.$$.fragment),this.h()},l(s){e=C(s,"DIV",{class:!0});var r=y(e);re(t.$$.fragment,r),r.forEach(_),this.h()},h(){w(e,"class","embedding-badge truncate"),T(e,"embedding-badge-nolabel",n[1])},m(s,r){P(s,e,r),ce(t,e,null),l=!0,a||(c=de(Je.call(null,e,{text:"Embedding index"})),a=!0)},p(s,[r]){const d=r&4?Ce(i,[r&4&&st(s[2]),i[1],r&0&&{icon:Le}]):{};r&11&&(d.$$scope={dirty:r,ctx:s}),t.$set(d),(!l||r&2)&&T(e,"embedding-badge-nolabel",s[1])},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){I(t.$$.fragment,s),l=!1},d(s){s&&_(e),ue(t),a=!1,c()}}}function It(n,e,t){const l=["embedding","hideEmbeddingName"];let a=J(e,l),{embedding:c}=e,{hideEmbeddingName:i=!1}=e;return n.$$set=o=>{e=U(U({},e),ae(o)),t(2,a=J(e,l)),"embedding"in o&&t(0,c=o.embedding),"hideEmbeddingName"in o&&t(1,i=o.hideEmbeddingName)},[c,i,a]}class Mt extends ee{constructor(e){super(),te(this,e,It,Tt,le,{embedding:0,hideEmbeddingName:1})}}function Re(n,e,t){const l=n.slice();return l[12]=e[t],l}function Ae(n){let e,t,l=n[0].conceptNamespace+"",a,c,i=n[0].conceptName+"",o,s,r,d,u,h,m,v,g,p,b;return u=new Vt({}),v=new Ct({}),{c(){e=N("div"),t=N("div"),a=D(l),c=D(" / "),o=D(i),s=Y(),r=N("div"),d=N("button"),oe(u.$$.fragment),h=Y(),m=N("button"),oe(v.$$.fragment),this.h()},l(E){e=C(E,"DIV",{class:!0});var B=y(e);t=C(B,"DIV",{class:!0});var M=y(t);a=R(M,l),c=R(M," / "),o=R(M,i),M.forEach(_),s=q(B),r=C(B,"DIV",{class:!0});var V=y(r);d=C(V,"BUTTON",{class:!0});var L=y(d);re(u.$$.fragment,L),L.forEach(_),h=q(V),m=C(V,"BUTTON",{class:!0});var W=y(m);re(v.$$.fragment,W),W.forEach(_),V.forEach(_),B.forEach(_),this.h()},h(){w(t,"class","flex-grow"),w(d,"class","p-1"),w(m,"class","p-1"),w(r,"class","shrink-0"),w(e,"class","flex flex-row items-center justify-between gap-x-4 p-2")},m(E,B){P(E,e,B),k(e,t),k(t,a),k(t,c),k(t,o),k(e,s),k(e,r),k(r,d),ce(u,d,null),k(r,h),k(r,m),ce(v,m,null),g=!0,p||(b=[fe(d,"click",n[8]),fe(m,"click",n[9])],p=!0)},p(E,B){(!g||B&1)&&l!==(l=E[0].conceptNamespace+"")&&j(a,l),(!g||B&1)&&i!==(i=E[0].conceptName+"")&&j(o,i)},i(E){g||(H(u.$$.fragment,E),H(v.$$.fragment,E),g=!0)},o(E){I(u.$$.fragment,E),I(v.$$.fragment,E),g=!1},d(E){E&&_(e),ue(u),ue(v),p=!1,Qe(b)}}}function Oe(n){let e,t=[],l=new Map,a,c=n[2];const i=o=>o[12];for(let o=0;o<c.length;o+=1){let s=Re(n,c,o),r=i(s);l.set(r,t[o]=Ue(r,s))}return{c(){e=N("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=C(o,"DIV",{class:!0});var s=y(e);for(let r=0;r<t.length;r+=1)t[r].l(s);s.forEach(_),this.h()},h(){w(e,"class","more-button flex flex-col")},m(o,s){P(o,e,s);for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(e,null);a=!0},p(o,s){s&29&&(c=o[2],x(),t=Ze(t,s,i,1,o,c,l,e,ot,Ue,null,Re),$())},i(o){if(!a){for(let s=0;s<c.length;s+=1)H(t[s]);a=!0}},o(o){for(let s=0;s<t.length;s+=1)I(t[s]);a=!1},d(o){o&&_(e);for(let s=0;s<t.length;s+=1)t[s].d()}}}function Ue(n,e){let t,l,a,c,i,o,s,r,d;i=new Mt({props:{class:"hover:cursor-pointer",embedding:e[12]}});function u(){return e[10](e[12])}return{key:n,first:null,c(){t=N("button"),l=N("div"),a=D("Find similar"),c=Y(),oe(i.$$.fragment),o=Y(),this.h()},l(h){t=C(h,"BUTTON",{class:!0});var m=y(t);l=C(m,"DIV",{});var v=y(l);a=R(v,"Find similar"),v.forEach(_),c=q(m),re(i.$$.fragment,m),o=q(m),m.forEach(_),this.h()},h(){w(t,"class","flex w-full items-center justify-between"),this.first=t},m(h,m){P(h,t,m),k(t,l),k(l,a),k(t,c),ce(i,t,null),k(t,o),s=!0,r||(d=fe(t,"click",u),r=!0)},p(h,m){e=h;const v={};m&4&&(v.embedding=e[12]),i.$set(v)},i(h){s||(H(i.$$.fragment,h),s=!0)},o(h){I(i.$$.fragment,h),s=!1},d(h){h&&_(t),ue(i),r=!1,d()}}}function zt(n){let e,t,l,a,c,i,o,s=n[0].conceptName!=null&&n[0].conceptNamespace!=null&&Ae(n),r=n[3]!=null&&Oe(n);return{c(){e=N("div"),s&&s.c(),t=Y(),r&&r.c(),this.h()},l(d){e=C(d,"DIV",{style:!0,class:!0});var u=y(e);s&&s.l(u),t=q(u),r&&r.l(u),u.forEach(_),this.h()},h(){w(e,"style",l=n[1]!=null?`left: ${n[1].x}px; top: ${n[1].y}px`:""),w(e,"class","absolute z-10 inline-flex -translate-x-1/2 translate-y-6 flex-col divide-y divide-gray-200 rounded border border-gray-200 bg-white shadow")},m(d,u){P(d,e,u),s&&s.m(e,null),k(e,t),r&&r.m(e,null),c=!0,i||(o=de(Bt.call(null,e,n[11])),i=!0)},p(d,[u]){d[0].conceptName!=null&&d[0].conceptNamespace!=null?s?(s.p(d,u),u&1&&H(s,1)):(s=Ae(d),s.c(),H(s,1),s.m(e,t)):s&&(x(),I(s,1,1,()=>{s=null}),$()),d[3]!=null?r?(r.p(d,u),u&8&&H(r,1)):(r=Oe(d),r.c(),H(r,1),r.m(e,null)):r&&(x(),I(r,1,1,()=>{r=null}),$()),(!c||u&2&&l!==(l=d[1]!=null?`left: ${d[1].x}px; top: ${d[1].y}px`:""))&&w(e,"style",l)},i(d){c||(H(s),H(r),Ke(()=>{c&&(a||(a=Pe(e,Te,{duration:60},!0)),a.run(1))}),c=!0)},o(d){I(s),I(r),a||(a=Pe(e,Te,{duration:60},!1)),a.run(0),c=!1},d(d){d&&_(e),s&&s.d(),r&&r.d(),d&&a&&a.end(),i=!1,o()}}}function Dt(n,e,t){let{details:l}=e,{clickPosition:a}=e,{embeddings:c}=e,{addConceptLabel:i}=e,{findSimilar:o}=e,{addNotification:s}=e;const r=at();function d(g){if(!l.conceptName||!l.conceptNamespace)throw Error("Label could not be added, no active concept.");i(l.conceptNamespace,l.conceptName,l.text,g),s({kind:"success",title:`[${g===!0?"Positive":"Negative"}] Concept label added`,subtitle:ht(l.conceptNamespace,l.conceptName),message:l.text}),r("click")}const u=()=>d(!0),h=()=>d(!1),m=g=>{o&&o(g,l.text),r("click")},v=()=>r("close");return n.$$set=g=>{"details"in g&&t(0,l=g.details),"clickPosition"in g&&t(1,a=g.clickPosition),"embeddings"in g&&t(2,c=g.embeddings),"addConceptLabel"in g&&t(6,i=g.addConceptLabel),"findSimilar"in g&&t(3,o=g.findSimilar),"addNotification"in g&&t(7,s=g.addNotification)},[l,a,c,o,r,d,i,s,u,h,m,v]}class Rt extends ee{constructor(e){super(),te(this,e,Dt,zt,le,{details:0,clickPosition:1,embeddings:2,addConceptLabel:6,findSimilar:3,addNotification:7})}}function At(n,e){let t,l=e;n.addEventListener("click",i=>a(i));function a(i){l.disabled||(t=new Rt({props:{details:l.details(),clickPosition:{x:i.clientX,y:i.clientY},embeddings:l.embeddings,addConceptLabel:l.addConceptLabel,addNotification:l.addNotification,findSimilar:l.findSimilar},target:document.body}),t.$on("close",c),t.$on("click",c))}function c(){t==null||t.$destroy(),t=void 0}return{update(i){l=i,t==null||t.$set({details:l.details()})},destroy(){c()}}}function Fe(n,e,t){const l=n.slice();return l[7]=e[t],l}function je(n,e){let t,l,a=e[7].info.name+"",c,i,o,s,r=Ye(e[7])+"",d,u;return{key:n,first:null,c(){t=N("div"),l=N("div"),c=D(a),i=Y(),o=N("div"),s=N("span"),d=D(r),u=Y(),this.h()},l(h){t=C(h,"DIV",{class:!0});var m=y(t);l=C(m,"DIV",{class:!0});var v=y(l);c=R(v,a),v.forEach(_),i=q(m),o=C(m,"DIV",{class:!0});var g=y(o);s=C(g,"SPAN",{class:!0});var p=y(s);d=R(p,r),p.forEach(_),g.forEach(_),u=q(m),m.forEach(_),this.h()},h(){w(l,"class","named-value-name table-cell max-w-xs truncate pr-2 svelte-1689hje"),w(s,"class","px-1"),T(s,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Ee(e[7].info.dtype)),O(s,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Ne(e[7].value):""),w(o,"class","table-cell rounded text-right"),w(t,"class","table-row"),this.first=t},m(h,m){P(h,t,m),k(t,l),k(l,c),k(t,i),k(t,o),k(o,s),k(s,d),k(t,u)},p(h,m){e=h,m&1&&a!==(a=e[7].info.name+"")&&j(c,a),m&1&&r!==(r=Ye(e[7])+"")&&j(d,r),m&1&&T(s,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Ee(e[7].info.dtype)),m&1&&O(s,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?Ne(e[7].value):"")},d(h){h&&_(t)}}}function Ot(n){let e,t,l=[],a=new Map,c,i=`${n[4]}px`,o=`${Math.min(n[1],n[3]-n[2]-20)}px`,s=n[0];const r=d=>d[7];for(let d=0;d<s.length;d+=1){let u=Fe(n,s,d),h=r(u);a.set(h,l[d]=je(h,u))}return{c(){e=N("div"),t=N("div");for(let d=0;d<l.length;d+=1)l[d].c();this.h()},l(d){e=C(d,"DIV",{role:!0,class:!0});var u=y(e);t=C(u,"DIV",{class:!0});var h=y(t);for(let m=0;m<l.length;m+=1)l[m].l(h);h.forEach(_),u.forEach(_),this.h()},h(){w(t,"class","table border-spacing-y-2"),w(e,"role","tooltip"),w(e,"class","absolute max-w-fit -translate-y-full break-words border border-gray-300 bg-white px-2 shadow-md"),Ke(()=>n[6].call(e)),T(e,"hidden",n[0].length===0),O(e,"top",i),O(e,"left",o)},m(d,u){P(d,e,u),k(e,t);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(t,null);c=rt(e,n[6].bind(e))},p(d,[u]){u&1&&(s=d[0],l=Ze(l,u,r,1,d,s,a,t,ct,je,null,Fe)),u&1&&T(e,"hidden",d[0].length===0),u&6&&o!==(o=`${Math.min(d[1],d[3]-d[2]-20)}px`)&&O(e,"left",o)},i:z,o:z,d(d){d&&_(e);for(let u=0;u<l.length;u+=1)l[u].d();c()}}}function Ye(n){return typeof n.value=="number"?n.value.toFixed(3):n.info.dtype.type==="string_span"?"true":n.value}function Ut(n,e,t){let{namedValues:l}=e,{x:a}=e,{y:c}=e;const i=window.innerWidth;let o=0;const s=c-1;function r(){o=this.clientWidth,t(2,o)}return n.$$set=d=>{"namedValues"in d&&t(0,l=d.namedValues),"x"in d&&t(1,a=d.x),"y"in d&&t(5,c=d.y)},[l,a,o,i,s,c,r]}class Ft extends ee{constructor(e){super(),te(this,e,Ut,Ot,le,{namedValues:0,x:1,y:5})}}function jt(n,e){let t,l=e;const a=()=>i();l.isHovered&&c();function c(){const o=l.namedValues.filter(h=>Array.from(l.spansHovered).some(m=>{const v=xe(m);return $e(h.specificPath.slice(0,v.length),v)}));l.itemScrollContainer!=null&&l.itemScrollContainer.addEventListener("scroll",a);const s=n.getBoundingClientRect(),r=window.getComputedStyle(n),d=parseInt(r.getPropertyValue("line-height")),u=s.height>d?s.x+n.offsetLeft||n.clientLeft:s.x;t=new Ft({props:{namedValues:o,x:u,y:s.top},target:document.body})}function i(){var o;t==null||t.$destroy(),(o=l.itemScrollContainer)==null||o.removeEventListener("scroll",a)}return{update(o){i(),l=o,l.isHovered&&c()},destroy(){i()}}}const pe=600,ge=50;function Yt(n,e,t){const l=[],a=new Set;for(const c of n){let i=!1;const o=[];for(const b of c.paths)a.has(b)||(o.push(b),a.add(b));const s=[],r=[];let d=-1/0;for(const[b,E]of Object.entries(c.originalSpans)){const B=e[b],M=xe(b);if(!(B==null||B.length===0))for(const V of E)for(const L of B){const W=L.path.slice(M.length),F=mt(V,W);if(F==null)continue;const A=K.value(F),he=K.span(F);if(A==null&&he==null)continue;if(L.dtype.type==="float32"){const ne=K.value(F);ne!=null&&(d=Math.max(d,ne))}const me=Se(K.path(V)),be=!o.includes(me),X={value:A,info:L,specificPath:K.path(F)};be||s.push(X),r.push(X),L.type==="concept_score"||L.type==="semantic_similarity"?A>.5&&(i=!0):i=!0}}const u=r.some(b=>b.info.type==="label"),h=r.some(b=>b.info.type==="leaf_span"),m=r.some(b=>b.info.type==="keyword"),v=r.some(b=>b.info.type==="metadata"&&!Ee(b.info.dtype)),g=c.paths.some(b=>t.has(b)),p=g&&o.length>0&&Array.from(t).some(b=>o.includes(b));l.push({backgroundColor:Ne(d),isBlackBolded:m||v||h,isHighlightBolded:u,isHighlighted:i,snippetScore:d,namedValues:s,paths:c.paths,text:c.text,originalSpans:c.originalSpans,isHovered:g,isFirstHover:p})}return l}function qt(n,e){var c;let t=!1,l=!1,a=[];for(let i=0;i<n.length;i++){const o=n[i],s=i-1>=0?n[i-1]:null,r=i+1<n.length?n[i+1]:null,d=(c=a.at(-1))==null?void 0:c.isEllipsis;if(!o.isHighlighted){if(d||s!=null&&s.isHighlighted||r!=null&&r.isHighlighted)continue;t=!0,a.push({isEllipsis:!0});continue}l=!0,s!=null&&!s.isHighlighted&&(!d&&s.text.length>ge&&(a.push({isEllipsis:!0}),t=!0),a.push({renderSpan:s,snippetText:s.text.slice(-ge)})),a.push({renderSpan:o,snippetText:o.text}),r!=null&&!r.isHighlighted&&(a.push({renderSpan:r,snippetText:r.text.slice(0,ge)}),!d&&r.text.length>ge&&(a.push({isEllipsis:!0}),t=!0))}return l||(a=[],t=!1,a.push({renderSpan:n[0],snippetText:n[0].text.slice(0,pe)}),((n[1]||null)!=null||n[0].text.length>pe)&&(a.push({isEllipsis:!0}),t=!0)),e&&(a=n.map(i=>({renderSpan:i,snippetText:i.text}))),{snippetSpans:a,textIsOverBudget:t}}function qe(n,e,t){const l=n.slice();return l[34]=e[t],l}function Wt(n){const e=n.slice(),t=e[34].renderSpan;return e[37]=t,e}function Xt(n){let e,t,l,a;return{c(){e=N("span"),t=D(`...
      `),this.h()},l(c){e=C(c,"SPAN",{class:!0});var i=y(e);t=R(i,`...
      `),i.forEach(_),this.h()},h(){w(e,"class","highlight-span text-sm leading-5 svelte-1e6kot5")},m(c,i){P(c,e,i),k(e,t),l||(a=de(Je.call(null,e,{text:`Some text was hidden to improve readability. 
Click "Show all" to show the entire document.`})),l=!0)},p:z,i:z,o:z,d(c){c&&_(e),l=!1,a()}}}function Gt(n){let e,t,l,a,c,i,o,s;const r=[Qt,Kt],d=[];function u(g,p){return g[2]?0:1}t=u(n),l=d[t]=r[t](n);function h(){return n[30](n[37])}function m(){return n[31](n[37])}function v(){return n[32](n[37])}return{c(){e=N("span"),l.c(),this.h()},l(g){e=C(g,"SPAN",{class:!0});var p=y(e);l.l(p),p.forEach(_),this.h()},h(){w(e,"class","hover:cursor-poiner highlight-span break-words text-sm leading-5 svelte-1e6kot5"),T(e,"highlighted",n[37].isHighlighted),T(e,"hover:cursor-pointer",n[1].length>0),T(e,"font-bold",n[37].isBlackBolded),T(e,"font-medium",n[37].isHighlightBolded&&!n[37].isBlackBolded),O(e,"color",n[37].isHighlightBolded&&!n[37].isBlackBolded?Ie:""),O(e,"background-color",n[37].isHovered?Me(Xe):n[37].backgroundColor)},m(g,p){P(g,e,p),d[t].m(e,null),i=!0,o||(s=[de(a=jt.call(null,e,{namedValues:n[37].namedValues,isHovered:n[37].isFirstHover,spansHovered:n[5],itemScrollContainer:n[8]})),de(c=At.call(null,e,{details:h,findSimilar:n[9].page==="datasets"?n[17]:null,embeddings:n[3],addConceptLabel:n[15],addNotification:n[18]!=null?n[18].addNotification:Ge,disabled:n[37].paths.length===0||n[3].length===0})),fe(e,"mouseenter",m),fe(e,"mouseleave",v)],o=!0)},p(g,p){n=g;let b=t;t=u(n),t===b?d[t].p(n,p):(x(),I(d[b],1,1,()=>{d[b]=null}),$(),l=d[t],l?l.p(n,p):(l=d[t]=r[t](n),l.c()),H(l,1),l.m(e,null)),a&&Be(a.update)&&p[0]&352&&a.update.call(null,{namedValues:n[37].namedValues,isHovered:n[37].isFirstHover,spansHovered:n[5],itemScrollContainer:n[8]}),c&&Be(c.update)&&p[0]&584&&c.update.call(null,{details:h,findSimilar:n[9].page==="datasets"?n[17]:null,embeddings:n[3],addConceptLabel:n[15],addNotification:n[18]!=null?n[18].addNotification:Ge,disabled:n[37].paths.length===0||n[3].length===0}),(!i||p[0]&64)&&T(e,"highlighted",n[37].isHighlighted),(!i||p[0]&2)&&T(e,"hover:cursor-pointer",n[1].length>0),(!i||p[0]&64)&&T(e,"font-bold",n[37].isBlackBolded),(!i||p[0]&64)&&T(e,"font-medium",n[37].isHighlightBolded&&!n[37].isBlackBolded),p[0]&64&&O(e,"color",n[37].isHighlightBolded&&!n[37].isBlackBolded?Ie:""),p[0]&64&&O(e,"background-color",n[37].isHovered?Me(Xe):n[37].backgroundColor)},i(g){i||(H(l),i=!0)},o(g){I(l),i=!1},d(g){g&&_(e),d[t].d(),o=!1,Qe(s)}}}function Kt(n){let e=n[34].snippetText+"",t;return{c(){t=D(e)},l(l){t=R(l,e)},m(l,a){P(l,t,a)},p(l,a){a[0]&64&&e!==(e=l[34].snippetText+"")&&j(t,e)},i:z,o:z,d(l){l&&_(t)}}}function Qt(n){let e,t,l,a;return t=new wt({props:{source:n[34].snippetText}}),{c(){e=N("div"),oe(t.$$.fragment),l=Y(),this.h()},l(c){e=C(c,"DIV",{class:!0});var i=y(e);re(t.$$.fragment,i),i.forEach(_),l=q(c),this.h()},h(){w(e,"class","markdown")},m(c,i){P(c,e,i),ce(t,e,null),P(c,l,i),a=!0},p(c,i){const o={};i[0]&64&&(o.source=c[34].snippetText),t.$set(o)},i(c){a||(H(t.$$.fragment,c),a=!0)},o(c){I(t.$$.fragment,c),a=!1},d(c){c&&_(e),ue(t),c&&_(l)}}}function We(n){let e,t,l,a;const c=[Gt,Xt],i=[];function o(r,d){return r[34].isEllipsis?1:0}function s(r,d){return d===0?Wt(r):r}return e=o(n),t=i[e]=c[e](s(n,e)),{c(){t.c(),l=Ve()},l(r){t.l(r),l=Ve()},m(r,d){i[e].m(r,d),P(r,l,d),a=!0},p(r,d){let u=e;e=o(r),e===u?i[e].p(s(r,e),d):(x(),I(i[u],1,1,()=>{i[u]=null}),$(),t=i[e],t?t.p(s(r,e),d):(t=i[e]=c[e](s(r,e)),t.c()),H(t,1),t.m(l.parentNode,l))},i(r){a||(H(t),a=!0)},o(r){I(t),a=!1},d(r){i[e].d(r),r&&_(l)}}}function Zt(n){let e,t,l=n[6],a=[];for(let i=0;i<l.length;i+=1)a[i]=We(qe(n,l,i));const c=i=>I(a[i],1,1,()=>{a[i]=null});return{c(){e=N("div");for(let i=0;i<a.length;i+=1)a[i].c();this.h()},l(i){e=C(i,"DIV",{class:!0});var o=y(e);for(let s=0;s<a.length;s+=1)a[s].l(o);o.forEach(_),this.h()},h(){w(e,"class","overflow-x-hidden text-ellipsis whitespace-break-spaces svelte-1e6kot5"),T(e,"text-preview-overlay",n[0]&&n[7]>pe&&!n[4])},m(i,o){P(i,e,o);for(let s=0;s<a.length;s+=1)a[s]&&a[s].m(e,null);t=!0},p(i,o){if(o[0]&441198){l=i[6];let s;for(s=0;s<l.length;s+=1){const r=qe(i,l,s);a[s]?(a[s].p(r,o),H(a[s],1)):(a[s]=We(r),a[s].c(),H(a[s],1),a[s].m(e,null))}for(x(),s=l.length;s<a.length;s+=1)c(s);$()}(!t||o[0]&145)&&T(e,"text-preview-overlay",i[0]&&i[7]>pe&&!i[4])},i(i){if(!t){for(let o=0;o<l.length;o+=1)H(a[o]);t=!0}},o(i){a=a.filter(Boolean);for(let o=0;o<a.length;o+=1)I(a[o]);t=!1},d(i){i&&_(e),dt(a,i)}}}const Xe=.9,Ge=()=>null;function Jt(n,e,t){let l,a,c,i,o,{text:s}=e,{row:r}=e,{field:d=void 0}=e,{spanPaths:u}=e,{path:h=void 0}=e,{valuePaths:m}=e,{markdown:v=!1}=e,{embeddings:g}=e,{datasetViewStore:p=void 0}=e,{isExpanded:b=!1}=e,{textIsOverBudget:E=!1}=e;const B=gt();we(n,B,f=>t(9,o=f));let M,V={},L=new Set;const W=f=>{f.paths.forEach(S=>L.add(S)),t(5,L)},F=f=>{f.paths.forEach(S=>L.delete(S)),t(5,L)};let A={};const he=f=>{const G={conceptName:null,conceptNamespace:null,text:a.filter(ie=>ie.paths.some(ye=>((f==null?void 0:f.paths)||[]).some(se=>$e(se,ye)))).map(ie=>ie.text).join("")};for(const ie of Object.keys(f.originalSpans)){const ye=(V[ie]||[]).filter(se=>se.type==="concept_score");for(const se of ye){const He=se.signal;G.conceptName=He.concept_name,G.conceptNamespace=He.namespace;break}}return G},me=_t();we(n,me,f=>t(33,c=f));const be=(f,S,ke,G)=>{if(!S||!f)throw Error("Label could not be added, no active concept.");c.mutate([f,S,{insert:[{text:ke,label:G}]}])};let X,ne=ut(pt);we(n,ne,f=>t(8,i=f));const et=(f,S)=>{p==null||d==null||p.addSearch({path:d.path,type:"semantic",query_type:"document",query:S,embedding:f})},tt=Et();let ve=0;const lt=f=>he(f),nt=f=>W(f),it=f=>F(f);return n.$$set=f=>{"text"in f&&t(19,s=f.text),"row"in f&&t(20,r=f.row),"field"in f&&t(21,d=f.field),"spanPaths"in f&&t(1,u=f.spanPaths),"path"in f&&t(22,h=f.path),"valuePaths"in f&&t(23,m=f.valuePaths),"markdown"in f&&t(2,v=f.markdown),"embeddings"in f&&t(3,g=f.embeddings),"datasetViewStore"in f&&t(24,p=f.datasetViewStore),"isExpanded"in f&&t(4,b=f.isExpanded),"textIsOverBudget"in f&&t(0,E=f.textIsOverBudget)},n.$$.update=()=>{if(n.$$.dirty[0]&5242882&&(t(25,M={}),u.forEach(f=>{let S=bt(r,f);vt(f,h)&&(S=S.filter(G=>kt(K.path(G),h)||h==null)),t(25,M[Se(f)]=S,M)})),n.$$.dirty[0]&75497472){t(26,V={});for(const f of m){const S=Se(f.spanPath);V[S]==null&&t(26,V[S]=[],V),V[S].push(f)}}if(n.$$.dirty[0]&34078720&&t(29,l=yt(s,M)),n.$$.dirty[0]&603979808&&t(28,a=Yt(l,V,L)),n.$$.dirty[0]&671088640){t(27,A={});for(const f of l)for(const S of f.paths)t(27,A[S]=A[S]||[],A),A[S].push(f)}if(n.$$.dirty[0]&268435472&&t(6,{snippetSpans:X,textIsOverBudget:E}=qt(a,b),X,(t(0,E),t(28,a),t(4,b),t(29,l),t(26,V),t(5,L),t(19,s),t(25,M),t(23,m),t(1,u),t(20,r),t(22,h))),n.$$.dirty[0]&192){t(7,ve=0);for(const f of X)f.isEllipsis||t(7,ve+=f.snippetText.length)}},[E,u,v,g,b,L,X,ve,i,o,B,W,F,he,me,be,ne,et,tt,s,r,d,h,m,p,M,V,A,a,l,lt,nt,it]}class ll extends ee{constructor(e){super(),te(this,e,Jt,Zt,le,{text:19,row:20,field:21,spanPaths:1,path:22,valuePaths:23,markdown:2,embeddings:3,datasetViewStore:24,isExpanded:4,textIsOverBudget:0},null,[-1,-1])}}export{Mt as E,ll as S,Vt as T,Ct as a,Bt as c};
