!function(t,e){if("function"==typeof define&&define.amd)define(["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var i={exports:{}};e(i.exports),t.modNotifications=i.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifications=void 0;const e=MyAMS.$;if(!e.templates){const t=require("jsrender");e.templates=t.templates}const i=e.templates({markup:'\n\t<li class="p-1 my-1{{if status}} alert-{{:status}}{{/if}}">\n\t\t<a class="d-flex flex-row"{{if url}} href="{{:url}}"{{/if}}>\n\t\t\t{{if source.avatar}}\n\t\t\t<img class="avatar mx-1 mt-1" src="{{:source.avatar}}"\n\t\t\t\t alt="{{:source.title}}" title="{{:source.title}}" />\n\t\t\t{{else}}\n\t\t\t<i class="avatar fa fa-fw fa-2x fa-user mx-1 mt-1"\n\t\t\t   title="{{:source.title}}"></i>\n\t\t\t{{/if}}\n\t\t\t<div class="flex-grow-1 ml-2">\n\t\t\t\t<small class="timestamp float-right text-muted">\n\t\t\t\t\t{{*: new Date(data.timestamp).toLocaleString()}}\n\t\t\t\t</small>\n\t\t\t\t<strong class="title d-block">\n\t\t\t\t\t{{:title}}\n\t\t\t\t</strong>\n\t\t\t\t<p class="text-muted mb-2">{{:message}}</p>\n\t\t\t</div>\n\t\t</a>\n\t</li>',allowCode:!0}),s=e.templates({markup:'\n\t<ul class="list-style-none flex-grow-1 overflow-auto m-0 p-0">\n\t\t{{for notifications tmpl=~itemTemplate /}}\n\t</ul>\n\t{{if !~options.hideTimestamp}}\n\t<div class="timestamp border-top pt-1">\n\t\t<span>{{*: MyAMS.i18n.LAST_UPDATE }}{{: ~timestamp.toLocaleString() }}</span>\n\t\t<i class="fa fa-fw fa-sync float-right"\n\t\t   data-ams-click-handler="MyAMS.notifications.getNotifications"\n\t\t   data-ams-click-handler-options=\'{"localTimestamp": "{{: ~useLocalTime }}"}\'></i>\n\t</div>\n\t{{/if}}',allowCode:!0});class n{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.values=t,this.options=e}render(t){e(t).html(s.render(this.values,{itemTemplate:i,timestamp:this.options.localTimestamp?new Date:new Date(this.values.timestamp),useLocalTime:this.options.localTimestamp?"true":"false",options:this.options}))}}const o=t.notifications={checkPermission:()=>new Promise(((t,e)=>{"Notification"in window?"denied"!==Notification.permission?"default"===Notification.permission?(()=>{try{Notification.requestPermission().then()}catch(t){return!1}return!0})()?Notification.requestPermission().then((e=>{t("granted"===e)})):Notification.requestPermission((e=>{t("granted"===e)})):t(!0):t(!1):(console.debug("Notifications are not supported by this browser!"),t(!1))})),checkUserPermission:()=>{MyAMS.notifications.checkPermission().then((()=>{}))},getNotifications:(t,i)=>{const s=e.extend({},i,t.data),a=e(t.target),r=e(t.currentTarget),c=r.data("ams-notifications-source")||r.parents("[data-ams-notifications-source]").data("ams-notifications-source");return new Promise(((t,i)=>{MyAMS.require("ajax").then((()=>{MyAMS.ajax.get(c,r.data("ams-notifications-params")||"",r.data("ams-notifications-options")||{}).then((i=>{const c=e(a.data("ams-notifications-target")||a.parents("[data-ams-notifications-target]").data("ams-notifications-target")||r.attr("href"));new n(i,s).render(c),e("#notifications-count").text(""),o.checkUserPermission(),t()}),i)}),i)}))},addNotification:(t,s)=>{const n=e("ul","#notifications-pane"),a=e(i.render(t)),r=e("#notifications-count"),c=parseInt(r.text())||0;n.prepend(a),r.text(c+1),s&&o.showDesktopNotification(t)},showDesktopNotification:t=>{o.checkPermission().then((e=>{if(!e)return;const i={title:t.title,body:t.message,icon:t.source.avatar},s=new Notification(i.title,i);t.url&&(s.onclick=()=>{window.open(t.url)})}))}};MyAMS.env.bundle?MyAMS.config.modules.push("notifications"):(MyAMS.notifications=o,console.debug("MyAMS: notifications module loaded..."))}));